<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Heal | Your Caring Partner</title>

  <script type="module" src="index.js"></script>
  <!-- Include Spline Viewer -->
  <script type="module" src="https://unpkg.com/@splinetool/viewer@1.9.48/build/spline-viewer.js"></script>
</head>

<body>
  <!-- Spline Viewer for the 3D Background -->
  <spline-viewer id="spline-background"
    url="https://prod.spline.design/3YOhxpZ8BGJ2RQXV/scene.splinecode"></spline-viewer>

  <!-- Main Container -->
  <div id="mainPage" class="container active">
    <h1>Heal | Your Caring Partner</h1>
    <p>Comfort, Connection, and Care: Your Wellness Starts Here!.</p>
    <button id="loginBtn">Login</button>
    <button id="signupBtn">Sign Up</button>
  </div>

  <!-- Login Container -->
  <div id="loginPage" class="container">
    <h1>Login</h1>
    <form id="loginForm">
      <input type="text" name="username" placeholder="Enter Username" required />
      <input type="password" name="password" placeholder="Password" required />
      <button type="submit">Login</button>
      <div id="loginError" class="error"></div>
    </form>
    <div class="link">
      <a href="#" id="backToMainFromLogin">Back to Main</a>
    </div>
  </div>

  <!-- Signup Container -->
  <div id="signupPage" class="container">
    <h1>Signup</h1>
    <form id="signupForm">
      <input type="text" name="name" placeholder="Username" required />
      <input type="password" name="password" placeholder="Password" required />
      <input type="password" name="confirmPassword" placeholder="Confirm Password" required />
      <div class="show-password">
        <input type="checkbox" id="showPassword" />
        <label for="showPassword">Show Password</label>
      </div>
      <button type="submit">Signup</button>
      <div id="signupError" class="error"></div>
    </form>
    <div class="link">
      <a href="#" id="backToMainFromSignup">Back to Main</a>
    </div>
  </div>

  <a href="/session" class="floating-btn">Join Anonymously</a>

  <!-- JavaScript -->
  <script>
    // Page navigation
    const mainPage = document.getElementById("mainPage");
    const loginPage = document.getElementById("loginPage");
    const signupPage = document.getElementById("signupPage");

    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");
    const backToMainFromLogin = document.getElementById(
      "backToMainFromLogin"
    );
    const backToMainFromSignup = document.getElementById(
      "backToMainFromSignup"
    );

    function showPage(page) {
      document.querySelectorAll(".container").forEach((container) => {
        container.classList.remove("active");
      });
      page.classList.add("active");
    }

    loginBtn.addEventListener("click", () => showPage(loginPage));
    signupBtn.addEventListener("click", () => showPage(signupPage));
    backToMainFromLogin.addEventListener("click", () => showPage(mainPage));
    backToMainFromSignup.addEventListener("click", () => showPage(mainPage));

    // Show/Hide password
    document
      .getElementById("showPassword")
      .addEventListener("change", function () {
        const passwordFields = signupPage.querySelectorAll(
          'input[name="password"], input[name="confirmPassword"]'
        );
        passwordFields.forEach((field) => {
          field.type = this.checked ? "text" : "password";
        });
      });

    // Handle login
    const loginForm = document.getElementById("loginForm");
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = loginForm.username.value.trim();
      const password = loginForm.password.value.trim();
      const loginError = document.getElementById("loginError");

      try {
        const response = await fetch("/loggin", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, password }),
        });
        const data = await response.json();

        if (response.ok) {
          window.location.href = "/session";
        } else {
          loginError.textContent = data.message || "Login failed!";
        }
      } catch {
        loginError.textContent = "Network error. Try again.";
      }
    });

    // Handle signup
    const signupForm = document.getElementById("signupForm");
    signupForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = signupForm.name.value.trim();
      const password = signupForm.password.value.trim();
      const confirmPassword = signupForm.confirmPassword.value.trim();
      const signupError = document.getElementById("signupError");

      if (password !== confirmPassword) {
        signupError.textContent = "Passwords do not match!";
        return;
      }

      try {
        const response = await fetch("/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, password }),
        });
        const data = await response.json();

        if (response.ok) {
          alert("Signup successful! Please log in.");
          showPage(loginPage);
        } else {
          signupError.textContent = data.message || "Signup failed!";
        }
      } catch {
        signupError.textContent = "Network error. Try again.";
      }
    });
  </script>
</body>

</html>